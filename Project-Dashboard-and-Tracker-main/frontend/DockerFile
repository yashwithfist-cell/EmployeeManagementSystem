# --- STAGE 1: Build the React App ---
# Use an official Node.js image as the builder environment
FROM node:lts-alpine AS build-stage
WORKDIR /app
# Copy package files and install dependencies (this is cached for faster builds)
COPY package*.json ./
RUN npm install
# Copy the rest of the application source code
COPY . .
# Run the production build
RUN npm run build

# --- STAGE 2: Serve the App from a Lightweight Server ---
# Use a fresh, minimal Node.js image for the final container
FROM node:lts-alpine
WORKDIR /app
# Install the 'serve' package globally inside the container
RUN npm install -g serve
# Copy ONLY the 'build' folder from the previous build stage
COPY --from=build-stage /app/build ./build

# Expose the port the server will run on
EXPOSE 80

# The command to run when the container starts
CMD ["serve", "-s", "build", "-l", "80"]